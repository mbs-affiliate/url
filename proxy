#!/bin/bash

apt-get update 
apt install -y build-essential 
apt install -y libevent-dev 
apt install -y libssl-dev
apt install -y git
add-apt-repository -y ppa:artyom.h31/3proxy
apt update
apt install -y 3proxy

#git clone https://github.com/z3APA3A/3proxy.git
#cd 3proxy
#make -f Makefile.Linux
#mkdir /usr/local/etc/3proxy 
#mkdir /usr/local/etc/3proxy/logs
#mkdir /usr/local/etc/3proxy/stat
#mkdir /usr/local/etc/3proxy/bin
#cp src/3proxy /usr/local/etc/3proxy/bin/
#cp scripts/rc.d/proxy.sh /etc/init.d/3proxy
#ln -s /usr/local/etc/3proxy/3proxy.cfg /etc/3proxy.cfg
#chmod +x /etc/init.d/3proxy
chown -R 65534:65534  /usr/local/etc/3proxy/

cat <<EOF > /etc/3proxy/conf/3proxy.cfg
nscache 65536
nserver 8.8.8.8
nserver 8.8.4.4
timeouts 1 5 30 60 180 1800 15 60
pidfile /usr/local/etc/3proxy/3proxy.pid
daemon
setgid 65534
setuid 65534
daemon
auth iponly
allow * 95.141.36.180
allow * 95.27.43.24
allow * 95.141.36.99
proxy -n -p2358 -a

EOF


service 3proxy start
echo "net.ipv4.icmp_echo_ignore_all = 1" >> /etc/sysctl.conf
sysctl -p

